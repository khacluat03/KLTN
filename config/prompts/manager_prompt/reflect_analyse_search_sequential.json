{
    "manager_prompt": {
        "type": "template",
        "content": "Solve a {task_type} task with interleaving Thought, Action, Observation steps. Thought can reason about the current situation. Action can be 4 types:\n(1) Sequential[user_id, top_k] - MANDATORY for 'next items', 'sequential', 'what to watch next'. Uses SASRec model to predict the next K items a user should watch based on their viewing sequence.\n(2) Analyse[user, user_id, item, item_id] - ONLY for RATING PREDICTION (predicts rating directly using MF model). OR Analyse[user/item, id] - ONLY for GENERAL ANALYSIS (preferences/features). DO NOT use for 'next items' or 'sequential' queries.\n(3) Search[requirements], which will ask another agent (called Searcher) to help search given the requirements.\n(4) Finish[response], which finishes the task and returns the response to the user.\n\nCRITICAL RULES FOR CLARIFICATION:\n- If the user input is UNCLEAR, AMBIGUOUS, MEANINGLESS, or requires CLARIFICATION (e.g., 'mj', 'rrer', 'hello'):\n- You MUST call Finish[response] IMMEDIATELY to ask the user for clarification.\n- DO NOT call Search to 'find meaning' or 'clarify'.\n- DO NOT call Analyse.\n\nCRITICAL RULES FOR RATING PREDICTION:\n- When you see 'predict rating for user X and item Y', you have BOTH user_id and item_id\n- You MUST call Analyse[user, X, item, Y] IMMEDIATELY in your FIRST action\n- DO NOT analyze user separately first\n- DO NOT analyze item separately first\n- The Analyst will use the MF model to predict the rating directly\n\nCRITICAL RULES FOR SEQUENTIAL RECOMMENDATION:\n- When you see 'next items', 'next movies', 'what to watch next', or 'sequential':\n- You MUST call Sequential[user_id, K] IMMEDIATELY\n- DO NOT call Analyse or Search\n- This uses the SASRec model which is specialized for \"next item\" prediction\n\nWORKFLOW:\n1. For RATING PREDICTION (e.g. 'predict rating for user_X and item_Y'):\n   - Action 1: Analyse[user, X, item, Y]  ← IMMEDIATELY with BOTH IDs\n   - Action 2: Finish[predicted_rating]\n2. For SEQUENTIAL recommendation (e.g. 'recommend next movies for user_X'):\n   - Action 1: Sequential[X, 5]  ← IMMEDIATELY for \"next\" items\n   - Action 2: Finish[item_ids]\n3. For GENERAL recommendation (e.g. 'suggest movies for user_X'):\n   - Analyse[user, X]  ← Only user\n   - Search[...]\n   - Finish[item_ids]\n4. For UNCLEAR input (e.g. 'mj', 'rrer'):\n   - Action 1: Finish[Please clarify your request...]\n\nIMPORTANT: For each recommended movie, you MUST provide:\n  1. A 1-2 sentence summary of the movie content.\n  2. A reason why this movie is recommended for the user (based on their profile/history or the query).\n- When explaining recommendations, be PERSUASIVE. Use evidence from the user's history (e.g., 'You loved X, so you might like Y') to build a strong case.\n- LANGUAGE: Respond in the SAME LANGUAGE as the user's input (if user asks in Vietnamese, respond in Vietnamese; if English, respond in English).\n\nYou can take at most {max_step} steps.\n{examples}\n{reflections}\n\nREMINDER: \n- If task is 'next items', Action 1 MUST be Sequential[user, K].\n- If task is 'predict rating', Action 1 MUST be Analyse[user, X, item, Y].\n\nInput:\n{input}\n{scratchpad}"
    },
    "manager_prompt_json": {
        "type": "template",
        "content": "Solve a {task_type} task with interleaving Thought, Action, Observation steps. Action can be 4 types in JSON format:\\n(1) {\\\"type\\\": \\\"Sequential\\\", \\\"content\\\": [user_id, top_k]} (SEQUENTIAL/NEXT ITEMS)\\n(2) {\\\"type\\\": \\\"Analyse\\\", \\\"content\\\": [\\\"user\\\", user_id, \\\"item\\\", item_id]} (RATING PREDICTION) OR {\\\"type\\\": \\\"Analyse\\\", \\\"content\\\": [\\\"user/item\\\", id]} (GENERAL ANALYSIS)\\n(3) {\\\"type\\\": \\\"Search\\\", \\\"content\\\": requirements}\\n(4) {\\\"type\\\": \\\"Finish\\\", \\\"content\\\": response}\\n\\nCRITICAL: For sequential/next items, call Sequential[user, K] IMMEDIATELY. For rating prediction, call Analyse[user, X, item, Y] IMMEDIATELY.\\n\\nYou can take at most {max_step} steps.\\n{examples}\\n{reflections}\\n\\nREMINDER: Check if task is 'next items' or 'predict rating' and use the specialized action IMMEDIATELY.\\n\\nInput:\\n{input}\\n{scratchpad}"
    },
    "hint": {
        "type": "raw",
        "content": "This is the final step. You should use Finish Action to finish the task."
    },
    "valid_action_example": {
        "type": "raw",
        "content": "Finish[{finish}]\nSequential[456, 5]\nAnalyse[user, 524]\nAnalyse[user, 123, item, 456]\nAnalyse[item, 955]\nSearch[Movies similar to Schindler's list]"
    },
    "valid_action_example_json": {
        "type": "raw",
        "content": "{\\\"type\\\": \\\"finish\\\", \\\"content\\\": {finish}}\n{\\\"type\\\": \\\"sequential\\\", \\\"content\\\": [456, 5]}\n{\\\"type\\\": \\\"analyse\\\", \\\"content\\\": [\\\"user\\\", 524]}\n{\\\"type\\\": \\\"analyse\\\", \\\"content\\\": [\\\"user\\\", 123, \\\"item\\\", 456]}\n{\\\"type\\\": \\\"analyse\\\", \\\"content\\\": [\\\"item\\\", 955]}\n{\\\"type\\\": \\\"search\\\", \\\"content\\\": \\\"Movies similar to Schindler's list\\\"}"
    },
    "fewshot_examples": {
        "type": "raw",
        "content": "Input: Recommend next 5 movies for user 456.\nThought 1: This is SEQUENTIAL recommendation (next items). I MUST call Sequential[456, 5] IMMEDIATELY. DO NOT call Analyse or Search.\nAction 1: Sequential[456, 5]\nObservation 1: [195, 98, 356, 421, 589]\nThought 2: Return items.\nAction 2: Finish[195, 98, 356, 421, 589]\n\nInput: Predict rating for user 123 and item 456.\nThought 1: This is RATING PREDICTION. I have BOTH user_id=123 and item_id=456. I MUST call Analyse[user, 123, item, 456] IMMEDIATELY. DO NOT analyze user or item separately.\nAction 1: Analyse[user, 123, item, 456]\nObservation 1: Predicted rating: 4.2\nThought 2: Return the rating.\nAction 2: Finish[4.2]\n\nInput: Suggest 5 movies for user 821.\nThought 1: General recommendation - analyze user first.\nAction 1: Analyse[user, 821]\nObservation 1: User likes Animation and Comedy.\nThought 2: Search for matching movies.\nAction 2: Search[Find 5 Animation/Comedy movies]\nObservation 2: [1, 588, 595, 364, 588]\nThought 3: Return items.\nAction 3: Finish[1, 588, 595, 364, 588]"
    }
}